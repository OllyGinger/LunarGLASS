
Top IR:
; ModuleID = 'Top'

%S = type { <4 x float>, <4 x i32>, i32, <3 x float>, [5 x [3 x <3 x float>]] }
%fooBlock = type { <4 x float>, <2 x float>, <4 x i32>, %S, [2 x <2 x float>], [8 x [4 x <4 x float>]] }
%barBlock = type { <4 x float>, [3 x <3 x float>], <4 x i32>, i32 }

@color_shadow = internal global <4 x float> zeroinitializer
@s = external addrspace(2) constant %S
@__anon__0 = external addrspace(2) constant %fooBlock
@inst = external addrspace(2) constant [4 x %barBlock]

define fastcc void @main() {
entry:
  %0 = load i32 addrspace(2)* getelementptr inbounds (%S addrspace(2)* @s, i32 0, i32 2), !gla.uniform !2
  %1 = load <2 x float> addrspace(2)* getelementptr inbounds (%fooBlock addrspace(2)* @__anon__0, i32 0, i32 1), !gla.uniform !13
  %2 = call <4 x i32> @llvm.gla.textureSample.v4i32.v2f32(i32 2, i32 %0, i32 0, <2 x float> %1), !gla.precision !28
  %3 = sitofp <4 x i32> %2 to <4 x float>, !gla.precision !28
  %4 = load <4 x float> addrspace(2)* getelementptr inbounds ([4 x %barBlock] addrspace(2)* @inst, i32 0, i32 3, i32 0), !gla.uniform !26
  %5 = fadd <4 x float> %3, %4, !gla.precision !28
  %6 = load <4 x float> addrspace(2)* getelementptr inbounds (%fooBlock addrspace(2)* @__anon__0, i32 0, i32 0), !gla.uniform !13
  %color_shadow = fadd <4 x float> %5, %6, !gla.precision !28
  store <4 x float> %color_shadow, <4 x float>* @color_shadow
  br label %stage-epilogue

stage-epilogue:                                   ; preds = %entry
  %7 = load <4 x float>* @color_shadow
  call void @llvm.gla.fWriteData.v4f32(i32 1024, i32 -1, <4 x float> %7), !gla.output !0
  br label %stage-exit

stage-exit:                                       ; preds = %stage-epilogue
  ret void
}

declare <4 x i32> @llvm.gla.textureSample.v4i32.v2f32(i32, i32, i32, <2 x float>) nounwind readnone

declare void @llvm.gla.fWriteData.v4f32(i32, i32, <4 x float>) nounwind

!gla.outputs = !{!0}
!gla.uniforms = !{!2, !13, !26}

!0 = metadata !{metadata !"color", i32 7, <4 x float>* @color_shadow_typeProxy, metadata !1}
!1 = metadata !{i32 0, i32 2, i32 1024, null}
!2 = metadata !{metadata !"s", i32 12, %S* @s_typeProxy, metadata !3, metadata !4}
!3 = metadata !{i32 4, i32 0, i32 1024, null}
!4 = metadata !{metadata !"S", metadata !3, metadata !"u", metadata !5, metadata !"v", metadata !6, metadata !"sampler", metadata !8, metadata !"w", metadata !5, metadata !"m3a", metadata !11}
!5 = metadata !{metadata !"", metadata !1}
!6 = metadata !{metadata !"", metadata !7}
!7 = metadata !{i32 1, i32 2, i32 1024, null}
!8 = metadata !{metadata !"", metadata !9}
!9 = metadata !{i32 5, i32 1, i32 1024, metadata !10}
!10 = metadata !{i32 0, i32* @sampler_typeProxy_typeProxy, i32 1, i1 false, i1 false, i32 1}
!11 = metadata !{metadata !"", metadata !12}
!12 = metadata !{i32 3, i32 2, i32 1024, null}
!13 = metadata !{metadata !"", i32 13, %fooBlock addrspace(2)* @__anon__0, metadata !14, metadata !15}
!14 = metadata !{i32 6, i32 0, i32 1024, null}
!15 = metadata !{metadata !"fooBlock", metadata !14, metadata !"bu", metadata !16, metadata !"bw", metadata !16, metadata !"bv", metadata !18, metadata !"bs", metadata !20, metadata !"bm2", metadata !24, metadata !"m4a", metadata !24}
!16 = metadata !{metadata !"", metadata !17}
!17 = metadata !{i32 0, i32 0, i32 1024, null}
!18 = metadata !{metadata !"", metadata !19}
!19 = metadata !{i32 1, i32 0, i32 1024, null}
!20 = metadata !{metadata !"S", metadata !3, metadata !"u", metadata !5, metadata !"v", metadata !6, metadata !"sampler", metadata !21, metadata !"w", metadata !5, metadata !"m3a", metadata !11}
!21 = metadata !{metadata !"", metadata !22}
!22 = metadata !{i32 5, i32 1, i32 1024, metadata !23}
!23 = metadata !{i32 0, i32* @sampler_typeProxy_typeProxy, i32 1, i1 false, i1 false, i32 1}
!24 = metadata !{metadata !"", metadata !25}
!25 = metadata !{i32 3, i32 0, i32 1024, null}
!26 = metadata !{metadata !"inst", i32 13, [4 x %barBlock] addrspace(2)* @inst, metadata !14, metadata !27}
!27 = metadata !{metadata !"barBlock", metadata !14, metadata !"nbu", metadata !16, metadata !"nbm", metadata !24, metadata !"nbv", metadata !18, metadata !"ni", metadata !16}
!28 = metadata !{i32 2}


Bottom IR:
; ModuleID = 'Top'

%S = type { <4 x float>, <4 x i32>, i32, <3 x float>, [5 x [3 x <3 x float>]] }
%fooBlock = type { <4 x float>, <2 x float>, <4 x i32>, %S, [2 x <2 x float>], [8 x [4 x <4 x float>]] }
%barBlock = type { <4 x float>, [3 x <3 x float>], <4 x i32>, i32 }

@s = external addrspace(2) constant %S
@__anon__0 = external addrspace(2) constant %fooBlock
@inst = external addrspace(2) constant [4 x %barBlock]

define fastcc void @main() {
entry:
  %gla_constGEP = getelementptr %fooBlock addrspace(2)* @__anon__0, i32 0, i32 1
  %0 = load <2 x float> addrspace(2)* %gla_constGEP, align 16, !gla.uniform !13
  %gla_constGEP2 = getelementptr %S addrspace(2)* @s, i32 0, i32 2
  %1 = load i32 addrspace(2)* %gla_constGEP2, align 16, !gla.uniform !2
  %2 = call <4 x i32> @llvm.gla.textureSample.v4i32.v2f32(i32 2, i32 %1, i32 0, <2 x float> %0), !gla.precision !28
  %gla_constGEP3 = getelementptr [4 x %barBlock] addrspace(2)* @inst, i32 0, i32 3, i32 0
  %3 = load <4 x float> addrspace(2)* %gla_constGEP3, align 16, !gla.uniform !26
  %4 = sitofp <4 x i32> %2 to <4 x float>, !gla.precision !28
  %gla_constGEP4 = getelementptr %fooBlock addrspace(2)* @__anon__0, i32 0, i32 0
  %5 = load <4 x float> addrspace(2)* %gla_constGEP4, align 16, !gla.uniform !13
  %6 = fadd <4 x float> %4, %3, !gla.precision !28
  %color_shadow = fadd <4 x float> %6, %5, !gla.precision !28
  call void @llvm.gla.fWriteData.v4f32(i32 1024, i32 -1, <4 x float> %color_shadow), !gla.output !0
  br label %stage-epilogue

stage-epilogue:                                   ; preds = %entry
  br label %stage-exit

stage-exit:                                       ; preds = %stage-epilogue
  ret void
}

declare <4 x i32> @llvm.gla.textureSample.v4i32.v2f32(i32, i32, i32, <2 x float>) nounwind readnone

declare void @llvm.gla.fWriteData.v4f32(i32, i32, <4 x float>) nounwind

!gla.outputs = !{!0}
!gla.uniforms = !{!2, !13, !26}

!0 = metadata !{metadata !"color", i32 7, <4 x float>* @color_shadow_typeProxy, metadata !1}
!1 = metadata !{i32 0, i32 2, i32 1024, null}
!2 = metadata !{metadata !"s", i32 12, %S* @s_typeProxy, metadata !3, metadata !4}
!3 = metadata !{i32 4, i32 0, i32 1024, null}
!4 = metadata !{metadata !"S", metadata !3, metadata !"u", metadata !5, metadata !"v", metadata !6, metadata !"sampler", metadata !8, metadata !"w", metadata !5, metadata !"m3a", metadata !11}
!5 = metadata !{metadata !"", metadata !1}
!6 = metadata !{metadata !"", metadata !7}
!7 = metadata !{i32 1, i32 2, i32 1024, null}
!8 = metadata !{metadata !"", metadata !9}
!9 = metadata !{i32 5, i32 1, i32 1024, metadata !10}
!10 = metadata !{i32 0, i32* @sampler_typeProxy_typeProxy, i32 1, i1 false, i1 false, i32 1}
!11 = metadata !{metadata !"", metadata !12}
!12 = metadata !{i32 3, i32 2, i32 1024, null}
!13 = metadata !{metadata !"", i32 13, %fooBlock addrspace(2)* @__anon__0, metadata !14, metadata !15}
!14 = metadata !{i32 6, i32 0, i32 1024, null}
!15 = metadata !{metadata !"fooBlock", metadata !14, metadata !"bu", metadata !16, metadata !"bw", metadata !16, metadata !"bv", metadata !18, metadata !"bs", metadata !20, metadata !"bm2", metadata !24, metadata !"m4a", metadata !24}
!16 = metadata !{metadata !"", metadata !17}
!17 = metadata !{i32 0, i32 0, i32 1024, null}
!18 = metadata !{metadata !"", metadata !19}
!19 = metadata !{i32 1, i32 0, i32 1024, null}
!20 = metadata !{metadata !"S", metadata !3, metadata !"u", metadata !5, metadata !"v", metadata !6, metadata !"sampler", metadata !21, metadata !"w", metadata !5, metadata !"m3a", metadata !11}
!21 = metadata !{metadata !"", metadata !22}
!22 = metadata !{i32 5, i32 1, i32 1024, metadata !23}
!23 = metadata !{i32 0, i32* @sampler_typeProxy_typeProxy, i32 1, i1 false, i1 false, i32 1}
!24 = metadata !{metadata !"", metadata !25}
!25 = metadata !{i32 3, i32 0, i32 1024, null}
!26 = metadata !{metadata !"inst", i32 13, [4 x %barBlock] addrspace(2)* @inst, metadata !14, metadata !27}
!27 = metadata !{metadata !"barBlock", metadata !14, metadata !"nbu", metadata !16, metadata !"nbm", metadata !24, metadata !"nbv", metadata !18, metadata !"ni", metadata !16}
!28 = metadata !{i32 2}
#### BEGIN COMPILER 0 INFO LOG ####
#### END COMPILER 0 INFO LOG ####
#### BEGIN LINKER INFO LOG ####
#### END LINKER INFO LOG ####
#version 300 es
// LunarGOO output (r722)
struct S {
    mediump vec4 u;
    mediump uvec4 v;
    isampler2D sampler;
    mediump vec3 w;
    mediump mat3 m3a[5];
};

uniform S s;
uniform fooBlock {
    vec4 bu;
    vec2 bw;
    uvec4 bv;
    S bs;
    mat2 bm2;
    mat4 m4a[8];
} ;
uniform barBlock {
    vec4 nbu;
    mat3 nbm;
    uvec4 nbv;
    int ni;
} inst[4];
out mediump vec4 color;

void main()
{
    vec2 temp21 = bw;
    int temp22 = s.sampler;
    mediump ivec4 temp23 = texture(temp22, temp21);
    vec4 temp24 = inst[3].nbu;
    mediump vec4 temp25 = vec4(temp23);
    vec4 temp26 = bu;
    mediump vec4 temp27 = temp25 + temp24;
    mediump vec4 color_shadow = temp27 + temp26;
    color = color_shadow;
    
}

#### END COMPILER 0 INFO LOG ####
#### BEGIN LINKER INFO LOG ####
ERROR: Not all shaders have valid object code.
#### END LINKER INFO LOG ####
