
***Unsupported functionality: base type of sampler return type

***Unsupported functionality: unknown sampler dimension

Top IR:
; ModuleID = 'Top'

%S = type { <4 x float>, <4 x i32>, <3 x float> }
%fooBlock = type { <4 x float>, <2 x float>, i32, <4 x i32>, [2 x <2 x float>] }
%barBlock = type { <4 x float>, [3 x <3 x float>], <4 x i32>, i32 }

@color_shadow = internal global <4 x float> zeroinitializer
@s = external addrspace(2) constant %S
@__anon__0 = external addrspace(2) constant %fooBlock
@inst = external addrspace(2) constant %barBlock

define fastcc void @main() {
entry:
  %constructed = alloca <4 x float>
  %0 = load <4 x float> addrspace(2)* getelementptr inbounds (%S addrspace(2)* @s, i32 0, i32 0), !gla.uniform !2
  %1 = load <4 x i32> addrspace(2)* getelementptr inbounds (%S addrspace(2)* @s, i32 0, i32 1), !gla.uniform !2
  %2 = uitofp <4 x i32> %1 to <4 x float>
  %3 = fadd <4 x float> %0, %2
  %4 = load <4 x i32> addrspace(2)* getelementptr inbounds (%fooBlock addrspace(2)* @__anon__0, i32 0, i32 3), !gla.uniform !10
  %5 = uitofp <4 x i32> %4 to <4 x float>
  %6 = fadd <4 x float> %3, %5
  %7 = load <4 x float> addrspace(2)* getelementptr inbounds (%barBlock addrspace(2)* @inst, i32 0, i32 0), !gla.uniform !23
  %8 = load <4 x float>* %constructed
  %9 = extractelement <4 x float> %7, i32 0
  %10 = insertelement <4 x float> %8, float %9, i32 0
  %11 = extractelement <4 x float> %7, i32 1
  %12 = insertelement <4 x float> %10, float %11, i32 1
  %13 = extractelement <4 x float> %7, i32 2
  %14 = insertelement <4 x float> %12, float %13, i32 2
  %15 = extractelement <4 x float> %7, i32 3
  %16 = insertelement <4 x float> %14, float %15, i32 3
  %color_shadow = fadd <4 x float> %6, %16
  store <4 x float> %color_shadow, <4 x float>* @color_shadow
  br label %stage-epilogue

stage-epilogue:                                   ; preds = %entry
  %17 = load <4 x float>* @color_shadow
  call void @llvm.gla.fWriteData.v4f32(i32 1024, i32 -1, <4 x float> %17), !gla.output !0
  br label %stage-exit

stage-exit:                                       ; preds = %stage-epilogue
  ret void
}

declare void @llvm.gla.fWriteData.v4f32(i32, i32, <4 x float>) nounwind

!gla.outputs = !{!0}
!gla.uniforms = !{!2, !10, !23}

!0 = metadata !{metadata !"color", i32 7, <4 x float>* @color_shadow_typeProxy, metadata !1}
!1 = metadata !{i32 0, i32 0, i32 1024, null}
!2 = metadata !{metadata !"s", i32 12, %S* @s_typeProxy, metadata !3, metadata !4}
!3 = metadata !{i32 4, i32 0, i32 0, null}
!4 = metadata !{metadata !"S", metadata !5, metadata !"u", metadata !6, metadata !"v", metadata !8, metadata !"w", metadata !6}
!5 = metadata !{i32 4, i32 0, i32 63, null}
!6 = metadata !{metadata !"", metadata !7}
!7 = metadata !{i32 0, i32 0, i32 63, null}
!8 = metadata !{metadata !"", metadata !9}
!9 = metadata !{i32 1, i32 0, i32 63, null}
!10 = metadata !{metadata !"", i32 13, %fooBlock addrspace(2)* @__anon__0, metadata !11, metadata !12}
!11 = metadata !{i32 6, i32 0, i32 0, null}
!12 = metadata !{metadata !"fooBlock", metadata !13, metadata !"bu", metadata !14, metadata !"bw", metadata !14, metadata !"sampler", metadata !16, metadata !"bv", metadata !19, metadata !"bm2", metadata !21}
!13 = metadata !{i32 6, i32 0, i32 63, null}
!14 = metadata !{metadata !"", metadata !15}
!15 = metadata !{i32 0, i32 0, i32 0, null}
!16 = metadata !{metadata !"", metadata !17}
!17 = metadata !{i32 5, i32 0, i32 0, metadata !18}
!18 = metadata !{i32 0, i32* @sampler_typeProxy, i32 1, i1 false, i1 false, i32 0}
!19 = metadata !{metadata !"", metadata !20}
!20 = metadata !{i32 1, i32 0, i32 0, null}
!21 = metadata !{metadata !"", metadata !22}
!22 = metadata !{i32 3, i32 0, i32 0, null}
!23 = metadata !{metadata !"inst", i32 13, %barBlock addrspace(2)* @inst, metadata !11, metadata !24}
!24 = metadata !{metadata !"barBlock", metadata !13, metadata !"nbu", metadata !14, metadata !"nbm", metadata !21, metadata !"nbv", metadata !19, metadata !"ni", metadata !14}


Bottom IR:
; ModuleID = 'Top'

%S = type { <4 x float>, <4 x i32>, <3 x float> }
%fooBlock = type { <4 x float>, <2 x float>, i32, <4 x i32>, [2 x <2 x float>] }
%barBlock = type { <4 x float>, [3 x <3 x float>], <4 x i32>, i32 }

@s = external addrspace(2) constant %S
@__anon__0 = external addrspace(2) constant %fooBlock
@inst = external addrspace(2) constant %barBlock

define fastcc void @main() {
entry:
  %gla_constGEP = getelementptr %S addrspace(2)* @s, i32 0, i32 1
  %0 = load <4 x i32> addrspace(2)* %gla_constGEP, align 16, !gla.uniform !2
  %gla_constGEP2 = getelementptr %fooBlock addrspace(2)* @__anon__0, i32 0, i32 3
  %1 = load <4 x i32> addrspace(2)* %gla_constGEP2, align 16, !gla.uniform !10
  %2 = uitofp <4 x i32> %0 to <4 x float>
  %gla_constGEP3 = getelementptr %S addrspace(2)* @s, i32 0, i32 0
  %3 = load <4 x float> addrspace(2)* %gla_constGEP3, align 16, !gla.uniform !2
  %4 = uitofp <4 x i32> %1 to <4 x float>
  %5 = fadd <4 x float> %2, %3
  %gla_constGEP4 = getelementptr %barBlock addrspace(2)* @inst, i32 0, i32 0
  %6 = load <4 x float> addrspace(2)* %gla_constGEP4, align 16, !gla.uniform !23
  %7 = fadd <4 x float> %4, %5
  %color_shadow = fadd <4 x float> %6, %7
  call void @llvm.gla.fWriteData.v4f32(i32 1024, i32 -1, <4 x float> %color_shadow), !gla.output !0
  br label %stage-epilogue

stage-epilogue:                                   ; preds = %entry
  br label %stage-exit

stage-exit:                                       ; preds = %stage-epilogue
  ret void
}

declare void @llvm.gla.fWriteData.v4f32(i32, i32, <4 x float>) nounwind

!gla.outputs = !{!0}
!gla.uniforms = !{!2, !10, !23}

!0 = metadata !{metadata !"color", i32 7, <4 x float>* @color_shadow_typeProxy, metadata !1}
!1 = metadata !{i32 0, i32 0, i32 1024, null}
!2 = metadata !{metadata !"s", i32 12, %S* @s_typeProxy, metadata !3, metadata !4}
!3 = metadata !{i32 4, i32 0, i32 0, null}
!4 = metadata !{metadata !"S", metadata !5, metadata !"u", metadata !6, metadata !"v", metadata !8, metadata !"w", metadata !6}
!5 = metadata !{i32 4, i32 0, i32 63, null}
!6 = metadata !{metadata !"", metadata !7}
!7 = metadata !{i32 0, i32 0, i32 63, null}
!8 = metadata !{metadata !"", metadata !9}
!9 = metadata !{i32 1, i32 0, i32 63, null}
!10 = metadata !{metadata !"", i32 13, %fooBlock addrspace(2)* @__anon__0, metadata !11, metadata !12}
!11 = metadata !{i32 6, i32 0, i32 0, null}
!12 = metadata !{metadata !"fooBlock", metadata !13, metadata !"bu", metadata !14, metadata !"bw", metadata !14, metadata !"sampler", metadata !16, metadata !"bv", metadata !19, metadata !"bm2", metadata !21}
!13 = metadata !{i32 6, i32 0, i32 63, null}
!14 = metadata !{metadata !"", metadata !15}
!15 = metadata !{i32 0, i32 0, i32 0, null}
!16 = metadata !{metadata !"", metadata !17}
!17 = metadata !{i32 5, i32 0, i32 0, metadata !18}
!18 = metadata !{i32 0, i32* @sampler_typeProxy, i32 1, i1 false, i1 false, i32 0}
!19 = metadata !{metadata !"", metadata !20}
!20 = metadata !{i32 1, i32 0, i32 0, null}
!21 = metadata !{metadata !"", metadata !22}
!22 = metadata !{i32 3, i32 0, i32 0, null}
!23 = metadata !{metadata !"inst", i32 13, %barBlock addrspace(2)* @inst, metadata !11, metadata !24}
!24 = metadata !{metadata !"barBlock", metadata !13, metadata !"nbu", metadata !14, metadata !"nbm", metadata !21, metadata !"nbv", metadata !19, metadata !"ni", metadata !14}
#### BEGIN COMPILER 0 INFO LOG ####
#### END COMPILER 0 INFO LOG ####
#### BEGIN LINKER INFO LOG ####
#### END LINKER INFO LOG ####

// LunarGOO(r722) output
#version 300 es
struct S {
    vec4 u;
    uvec4 v;
    vec3 w;
};

uniform S s;
uniform fooBlock {
    vec4 bu;
    vec2 bw;
    sampler2D sampler;
    uvec4 bv;
    mat2 bm2;
} ;
uniform barBlock {
    vec4 nbu;
    mat3 nbm;
    uvec4 nbv;
    int ni;
} inst;
out vec4 color;

void main()
{
    ivec4 temp21 = s.v;
    ivec4 temp22 = bv;
    vec4 temp23 = vec4(temp21);
    vec4 temp24 = s.u;
    vec4 temp25 = vec4(temp22);
    vec4 temp26 = temp23 + temp24;
    vec4 temp27 = inst.nbu;
    vec4 temp28 = temp25 + temp26;
    vec4 color_shadow = temp27 + temp28;
    color = color_shadow;
    
}
#### END COMPILER 0 INFO LOG ####
#### BEGIN LINKER INFO LOG ####
ERROR: Not all shaders have valid object code.
#### END LINKER INFO LOG ####
